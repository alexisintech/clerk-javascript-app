<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Clerk + JavaScript App</title>
  </head>
  <body>
    <div id="signed-in"></div>

    <div id="sign-up">
      <h2>Sign up</h2>
      <form id="sign-up-form">
        <label for="sign-up-phone">Enter phone number</label>
        <input type="tel" name="phone" id="sign-up-phone" />
        <button type="submit">Continue</button>
      </form>
    </div>

    <form id="verifying" hidden>
      <label for="code">Enter your verification code</label>
      <input id="code" name="code" />
      <button type="submit" id="verify-button">Verify</button>
    </form>

    <!-- Initialize Clerk with your
    Clerk Publishable key and Frontend API URL -->
    <script
      async
      crossorigin="anonymous"
      data-clerk-publishable-key="pk_test_Y2xlYW4tbWF5Zmx5LTYyLmNsZXJrLmFjY291bnRzLmRldiQ"
      src="https://https://clean-mayfly-62.clerk.accounts.dev/npm/@clerk/clerk-js@beta/dist/clerk.browser.js"
      type="text/javascript"
    ></script>

    <script>
      window.addEventListener("load", async function () {
        await Clerk.load();

        console.log(Clerk);

        if (Clerk.user) {
          // Mount user button component
          document.getElementById("signed-in").innerHTML = `
            <div id="user-button"></div>
          `;

          const userbuttonDiv = document.getElementById("user-button");

          Clerk.mountUserButton(userbuttonDiv);
        } else {
          // Handle the sign-up form
          document
            .getElementById("sign-up-form")
            .addEventListener("submit", async (e) => {
              e.preventDefault();

              const formData = new FormData(e.target);
              const phone = formData.get("phone");

              try {
                // Start the sign-up process using the phone number method
                await Clerk.client.signUp.create({
                  phoneNumber: phone,
                });
                await Clerk.client.signUp.preparePhoneNumberVerification();
                // Hide sign-up form
                document.getElementById("sign-up").setAttribute("hidden", "");
                // Show verification form
                document.getElementById("verifying").removeAttribute("hidden");
              } catch (error) {
                console.error(error);
              }
            });

          // Handle the verification form
          document
            .getElementById("verifying")
            .addEventListener("submit", async (e) => {
              const formData = new FormData(e.target);
              const code = formData.get("code");

              try {
                // Verify the email address
                const verify =
                  await Clerk.client.signUp.attemptPhoneNumberVerification({
                    code,
                  });

                // Now that the user is created, set the session to active.
                await Clerk.setActive({ session: verify.createdSessionId });
              } catch (error) {
                console.error(error);
              }
            });
        }
      });
    </script>
  </body>
</html>
