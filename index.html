<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Clerk + JavaScript App</title>
  </head>
  <body>
    <div id="signed-in"></div>

    <p id="error" hidden></p>

    <div id="sign-in">
      <h2>Sign in</h2>
      <form id="sign-in-form">
        <label for="email">Enter email address</label>
        <input name="email" id="sign-in-email" />
        <label for="password">Enter password</label>
        <input name="password" id="sign-in-password" />
        <button type="submit">Continue</button>
      </form>
    </div>

    <script
      async
      crossorigin="anonymous"
      data-clerk-publishable-key="pk_test_Y2xlYW4tbWF5Zmx5LTYyLmNsZXJrLmFjY291bnRzLmRldiQ"
      src="https://clean-mayfly-62.clerk.accounts.dev/npm/@clerk/clerk-js@latest/dist/clerk.browser.js"
      type="text/javascript"
    ></script>

    <script>
      window.addEventListener('load', async function () {
        await Clerk.load();

        if (Clerk.user) {
          // Mount user button component
          document.getElementById('signed-in').innerHTML = `
    <div id="user-button"></div>
  `;

          const userbuttonDiv = document.getElementById('user-button');

          Clerk.mountUserButton(userbuttonDiv);
        } else {
          const errorContainer = document.getElementById('error');

          // Handle the sign-in form
          document
            .getElementById('sign-in-form')
            .addEventListener('submit', async (e) => {
              e.preventDefault();

              const formData = new FormData(e.target);
              const emailAddress = formData.get('email');
              const password = formData.get('password');

              try {
                // Start the sign-in process
                const signInAttempt = await Clerk.client.signIn.create({
                  identifier: emailAddress,
                  password,
                });

                // If the sign-in is complete, set the user as active
                if (signInAttempt.status === 'complete') {
                  await Clerk.setActive({
                    session: signInAttempt.createdSessionId,
                  });
                  location.reload();
                } else {
                  errorContainer.removeAttribute('hidden');
                  errorContainer.innerHTML = error.errors[0].longMessage;
                  console.error(error);
                }
              } catch (error) {
                errorContainer.removeAttribute('hidden');
                errorContainer.innerHTML = error.errors[0].longMessage;
                console.error(error);
              }
            });
        }
      });
    </script>
  </body>
</html>
